#!/bin/sh
set -e

## constants from relx template
RUNNER_ROOT_DIR="{{ runner_root_dir }}"
RUNNER_BIN_DIR="{{ runner_bin_dir }}"
ERTS_VSN="{{ erts_vsn }}"

ERTS_PATH=$RUNNER_ROOT_DIR/erts-$ERTS_VSN/bin

if [ "$1" = "funr" ]; then
    # ensure dir
    cd -P -- "$(dirname -- "$0")/.."
    if [ "$2" = "help" ]; then
        erl +B -pa lib/*/ebin -eval "user_default:help(), halt(0)" | grep -v Erlang/OTP
    else
        erl +B -pa lib/*/ebin -eval "user_default:init()" -- "$@"
    fi
else
    exec ${ERTS_PATH}/escript ${RUNNER_BIN_DIR}/emqtt_cli "$@"
fi
